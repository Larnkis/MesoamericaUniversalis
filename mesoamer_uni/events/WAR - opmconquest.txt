namespace = opmconquest

#This event is meant to make conquering OPMs more fun and less of a pain in the goddamn asshole
#If you occupy an OPM's capital, they have a chance of just surrendering to you and ending the war
#THIS DOES NOT WORK ON THE WARLEADER because if the warleader gets annexed, one of their allies becomes war leader and calls in all their allies and so on
country_event = {
		id = opmconquest.01
		
		title = "opmconquest1.t"
		desc = "opmconquest1.d"
		
		picture = COUNTRY_COLLAPSE_eventPicture
		
		trigger = {
			AND = { 
				capital_scope = { 
					NOT = { controlled_by = ROOT }
					NOT = { controlled_by = REB }
					has_province_modifier = occupation
					has_siege = no
				}
				capital_scope = {
					owner = {
						NOT = { num_of_cities = 2 }
					}
				}
				NOT = { has_country_modifier = warleader }
			}
			
		}
		
		mean_time_to_happen = {
			months = 12
			
			modifier = {
				factor = 1.5
				capital_scope = { 
					controller = {
						OR = { 
							government = tribal_confederation
							government = mayapan
							government = kuchkabal
							government = centralized_altepetl
							government = centralized_kingdom
							government = centralized_empire
							government = tlaxcallan_confederate
							government = tarascan_tribute_kingdom
						}
					}
				}
			}
			modifier = {
				factor = 0.10
				ai = yes
			}
			modifier = {
				factor = 0.75
				capital_scope = {
					controller = {
						OR = { 
							tag = TEN
							tag = TET
							tag = TCP
							tag = IUA
						}
					}
				}
			}
			modifier = {
				factor = 0
				capital_scope = { 
					owner  = {
						num_of_cities = 2
					}
				}
			}
			modifier = {
				factor = 1.5
				AND = {
					any_country = {
						offensive_war_with = ROOT
					}
					num_of_allies = 1
				}
			}
			
			modifier = { 
				factor = 0
				war_score = 100
			}
			modifier = { 
				factor = 6
				war_score = 75
			}
			modifier = { 
				factor = 4
				war_score = 50
			}
			modifier = { 
				factor = 2
				war_score = 25
			}
			modifier = { 
				factor = 0.90
				NOT = { war_score = 0 }
			}
			modifier = { 
				factor = 0.80
				NOT = { war_score = -25 }
			}
			modifier = { 
				factor = 0.50
				NOT = { war_score = -50 }
			}
		}
		
		option = {
			name = "opmconquest1.a"
			capital_scope = { 
				controller = { 
					country_event = { id = opmconquest.02 }
				}
			}
		}
}

country_event = {
	id = opmconquest.02
		
	title = "opmconquest2.t"
	desc = "opmconquest2.d"
		
	picture = COUNTRY_COLLAPSE_eventPicture
	
	is_triggered_only = yes
	
	#Take the province
	option = {
		name = "opmconquest2.a"
		trigger = {
			AND = {
				OR = { 
					government = tribal_confederation
					government = mayapan
					government = kuchkabal
					government = centralized_altepetl
					government = centralized_kingdom
					government = centralized_empire
					government = tarascan_tribute_kingdom
				}
				ROOT = { 
					border_distance = {
						who = FROM
						distance = 0
					}
				}
				NOT = {
					ROOT = { 
						border_distance = {
							who = FROM
							distance = 1
						}
					}
				}
				NOT = {
					OR = {
						government = tlaxcallan_confederate
						government = altepetl
						government = hegemonic_kingdom
						government = hegemonic_empire
					}
				}
			}
		}
		FROM = {
			capital_scope = { 
				remove_province_modifier = occupation
				cede_province = ROOT
			}
		}
		ai_chance = {
			factor = 50
			modifier = {
				overextension_percentage = 0.50
				factor = 0.50
			}
			modifier = {
				overextension_percentage = 0.75
				factor = 0.25
			}
			modifier = {
				overextension_percentage = 1.0
				factor = 0
			}
		}
	}
	
	#Turn them into a tributary
	option = {
		name = "opmconquest2.b"
		trigger = {
			OR = {
				OR = { 
					government = tlaxcallan_confederate
					government = altepetl
					government = hegemonic_kingdom
					government = hegemonic_empire
				}
				AND = {
					OR = { 
						government = tribal_confederation
						government = mayapan
						government = kuchkabal
						government = centralized_altepetl
						government = centralized_kingdom
						government = centralized_empire
						government = tarascan_tribute_kingdom
					}
					ROOT = { 
						border_distance = {
							who = FROM
							distance = 0
						}
					}
				}
			}
		}
		ROOT = {
			hidden_effect = { 
				FROM = {
					capital_scope = {
						cede_province = ROOT
					}
				}
			}
			hidden_effect = {
				release_vassal = FROM
			}
			create_protectorate = FROM
		}
		FROM = { 
			hidden_effect = {
				every_owned_province = {
					remove_province_modifier = occupation
				}
			}
			set_variable = { which = admin_influence_overlord value = 0 }
			set_variable = { which = subjectrevoltrisk value = 0 }
			capital_scope = {
				add_province_modifier = {
					name = e_expectedservice
					duration = -1
				}	
				add_province_modifier = {
					name = a_expectedservice
					duration = -1
				}
				add_province_modifier = {
					name = c_oldestson
					duration = -1
				}
			}
		}
		ai_chance = {
			factor = 50
			modifier = {
				ROOT = {
					border_distance = {
						who = FROM
						distance = 1
					}
				}
				factor = 0
			}
		}	
	}
	
	#Take luxury goods and let them off with white peace
	option = {
		name = "opmconquest2.c"
		ROOT = {
			change_variable = { which = luxurygoods value = 25 }#Make this more complicated in the future
			white_peace = FROM
		}
		ai_chance = {
			factor = 0
		}
	}
	
	#Let them off with white peace
	option = {
		name = "opmconquest2.dd"
		ROOT = {
			white_peace = FROM
		}
		ai_chance = {
			factor = 0
		}
	}
}
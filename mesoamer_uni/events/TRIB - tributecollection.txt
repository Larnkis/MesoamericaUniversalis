namespace = tributecoll

#THE FOLLOWING ARE PART OF THE 'SET TRIBUTE REQUIREMENTS' INTERFACE!

#What area to manage?
country_event = {
	id = tributecoll.01

	title = "tributecoll1.t"
	desc = "tributecoll1.d"
	picture = ECONOMY_eventPicture

	is_triggered_only = yes
		
	option = {
		name = "tributecoll1.a"
		trigger = {
			NOT = { has_country_modifier = tribreqs_changed_CD }
		}
		add_country_modifier = {
			name = tribreqs_high
			duration = -1
		}
		remove_country_modifier = tribreqs_normal
		remove_country_modifier = tribreqs_low
		add_country_modifier = {
			name = tribreqs_changed_CD
			duration = 1460
		}
		clr_country_flag = managingtribute
	}

	option = {
		name = "tributecoll1.b"
		trigger = {
			NOT = { has_country_modifier = tribreqs_changed_CD }
		}
		add_country_modifier = {
			name = tribreqs_normal
			duration = -1
		}
		remove_country_modifier = tribreqs_high
		remove_country_modifier = tribreqs_low
		add_country_modifier = {
			name = tribreqs_changed_CD
			duration = 1460
		}
		clr_country_flag = managingtribute
	}

	option = {
		name = "tributecoll1.c"
		trigger = {
			NOT = { has_country_modifier = tribreqs_changed_CD }
		}
		add_country_modifier = {
			name = tribreqs_low
			duration = -1
		}
		remove_country_modifier = tribreqs_high
		remove_country_modifier = tribreqs_normal
		add_country_modifier = {
			name = tribreqs_changed_CD
			duration = 1460
		}
		clr_country_flag = managingtribute
	}

	option = {
		name = "tributecoll1.dd"
		clr_country_flag = managingtribute
	}
}

#Send out the Tribute Collectors
#Also Decides Which Provinces Pay and Which Don't
country_event = {
	id = tributecoll.02

	title = "tributecoll2.t"
	desc = "tributecoll2.d"
	picture = ECONOMY_eventPicture

	is_triggered_only = yes
	
	immediate = {
		every_owned_province = {
			subtract_variable = { which = prov_unrest which = prov_unrest }
			subtract_variable = { which = refusal_points which = refusal_points }
			remove_province_modifier = will_pay
			remove_province_modifier = wont_pay
		}
		every_owned_province = {
			limit = {
				NOT = { is_capital = yes }
			}
			#Adds Refusal Points From Unrest
			#1 Point for every 2 unrest
			if = {
				limit = {
					unrest = 0.01
				}
				export_to_variable = {
					which = prov_unrest 
					value = unrest
				}
				
				while = {
					limit = {
						check_variable = {
							which = prov_unrest 
							value = 0
						}
					}
					subtract_variable = {
						which = prov_unrest
						value = 0.01
					}
					change_variable = { which = refusal_points value = 0.005 }
				}
			}
			
			if = {
				limit = {
					owner = {
						has_idea = giftsoflove
					}
				}	
				change_variable = { 
					which = refusal_points
					value = -1
				}
			}	
			#Adds Refusal Points from Legitimacy 
			if = {
				limit = {
					owner = {
						NOT = { legitimacy = 20 }
					}
				}
				change_variable = { 
					which = refusal_points
					value = 3
				}
			}
			
			if = {
				limit = {
					owner = {
						NOT = { legitimacy = 40 }
					}
				}
				change_variable = { 
					which = refusal_points
					value = 3
				}
			}
			
			if = {
				limit = {
					owner = {
						NOT = { legitimacy = 60 }
					}
				}
				change_variable = { 
					which = refusal_points
					value = 2
				}
			}
			
			if = {
				limit = {
					owner = {
						NOT = { legitimacy = 80 }
					}
				}
				change_variable = { 
					which = refusal_points
					value = 2
				}
			}
			
			if = {
				limit = {
					owner = {
						NOT = { legitimacy = 100 }
					}
				}
				change_variable = { 
					which = refusal_points
					value = 1
				}
			}
			
			#Adds Refusal Points from Neighboring Provinces
			if = {
				limit = {
					any_neighbor_province = {
						check_variable = { 
							which = refusal_points 
							value = 10
						}
					}
				}
				change_variable = { which = refusal_points value = 3 }
			}
			
			#Pay or Naw
			add_permanent_province_modifier = {
				name = will_pay
				duration = -1
			}
			if = {
				limit = {
					check_variable = { 
						which = refusal_points
						which = REFUSAL_CUTOFF
					}
				}
				random_list = {
					66 = {
						add_province_modifier = {
							name = wont_pay
							duration = 730
						}
						remove_province_modifier = will_pay
					}
					34 = {
						#Do Nothing
					}
				}
			}
		}
	}
	
	option = {
		name = "tributecoll2.a"
		hidden_effect = {
			country_event = { id = tributecoll.03 }
		}
	}
}

#Provinces Pay
country_event = {
	id = tributecoll.03
	
	title = "tributecoll3.t"
	desc = "tributecoll3.d"
	
	picture = ECONOMY_eventPicture 
	
	is_triggered_only = yes
	
	immediate = {
		
		subtract_variable = { which = total_ducats_dev which = total_ducats_dev }
		subtract_variable = { which = total_mp_dev which = total_mp_dev }
		
		export_to_variable = {
			which = total_ducats_dev
			value = total_development
		}
		export_to_variable = {
			which = total_mp_dev
			value = total_development
		}
		
		if = {
			limit = {
				has_country_modifier = tribreqs_low
			}
			multiply_variable = {
				which = total_ducats_dev
				value = 0.05
			}
		}
		if = {
			limit = {
				has_country_modifier = tribreqs_normal
			}
			multiply_variable = {
				which = total_ducats_dev
				value = 0.10
			}
		}
		if = {
			limit = {
				has_country_modifier = tribreqs_high
			}
			multiply_variable = {
				which = total_ducats_dev
				value = 0.20
			}
		}
		
		#Subtract Capital Development
		capital_scope = {
			export_to_variable = {
				which = capital_dev_trib
				value = development
			}
			while = {
				limit = {
					check_variable = {
						which = capital_dev_trib
						value = 0 
					}
				}
				owner = {
					#change_variable = { which = total_ducats_dev value = -1 }
					change_variable = { which = total_mp_dev value = -1 }
				}
				subtract_variable = {
					which = capital_dev_trib
					value = 1
				}
			}
		}
		#Subtract Non-Paying Provinces Development
		every_owned_province = {
			limit = {
				has_province_modifier = wont_pay
			}
			export_to_variable = {
				which = wont_pay_dev
				value = development
			}
			while = {
				limit = {
					check_variable = {
						which = wont_pay_dev
						value = 0 
					}
				}
				owner = {
					change_variable = { which = total_ducats_dev value = -0.25 }
					change_variable = { which = total_mp_dev value = -1 }
				}
				subtract_variable = {
					which = wont_pay_dev
					value = 1
				}
				set_variable = { which = wont_pay_dev value = 0 }
			}
		}
		
	}
	
	option = {
		name = "tributecoll3.a"
		
		if = {
			limit = {
				has_country_modifier = tribreqs_low
			}
			custom_tooltip = TRIB_duc_low
			custom_tooltip = TRIB_mp_low
			while = {
				limit = {
					check_variable = {
						which = total_ducats_dev
						value = 0
					}
				}
				add_treasury = 1
				subtract_variable = { which = total_ducats_dev value = 1}
			}
			while = {
				limit = {
					check_variable = {
						which = total_mp_dev
						value = 0
					}
					NOT = { manpower_percentage = 1.5 }
				}
				add_manpower = 1
				subtract_variable = { which = total_mp_dev value = 100 }
			}
		}
		
		if = {
			limit = {
				has_country_modifier = tribreqs_normal
			}
			custom_tooltip = TRIB_duc_normal
			custom_tooltip = TRIB_mp_normal
			while = {
				limit = {
					check_variable = {
						which = total_ducats_dev
						value = 0
					}
				}
				add_treasury = 1
				subtract_variable = { which = total_ducats_dev value = 1}
			}
			while = {
				limit = {
					check_variable = {
						which = total_mp_dev
						value = 0
					}
					NOT = { manpower_percentage = 1.5 }
				}
				add_manpower = 1
				subtract_variable = { which = total_mp_dev value = 75 }
			}
		}
		
		if = {
			limit = {
				has_country_modifier = tribreqs_high
			}
			custom_tooltip = TRIB_duc_high
			custom_tooltip = TRIB_mp_high
			while = {
				limit = {
					check_variable = {
						which = total_ducats_dev
						value = 0
					}
				}
				add_treasury = 1
				subtract_variable = { which = total_ducats_dev value = 1}
			}
			while = {
				limit = {
					check_variable = {
						which = total_mp_dev
						value = 0
					}
					NOT = { manpower_percentage = 1.5 }
				}
				add_manpower = 1
				subtract_variable = { which = total_mp_dev value = 50 }
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
}


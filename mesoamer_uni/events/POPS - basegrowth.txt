namespace = populations

country_event = {
	id = populations.01
	
	title = "popup1.t"
	desc = "popup1.d"
	picture = ECONOMY_eventPicture
	
	is_triggered_only = yes

	#hidden = yes

	option = {
		name = "popup1.a"
		
		hidden_effect = {
			if = {	
				limit = {
					MGI = {
						has_country_modifier = manpowercalcwait
					}
				}
				every_country = {
					add_manpower = -1000
					add_manpower = 0.99
				}
			}
		}
		every_country = {
			export_to_variable = {
				which = country_mp_level
				value = manpower_percentage
			}
		}
		every_province = {
			limit = {
				is_city = yes
			}
			#Calculate Growth Rate
			subtract_variable = { which = prov_growth_rate which = prov_growth_rate }
			change_variable = { which = prov_growth_rate value = 0.015 }
			
			export_to_variable = {
				which = prov_pop 
				value = development
			}
			
			#POSITIVE MODIFIERS
			if = {
				limit = {
					owner = {
						stability = 1
					}
				}
				change_variable = { which = prov_growth_rate value = 0.005 }
			}
			
			if = {
				limit = {
					owner = {
						stability = 2
					}
				}
				change_variable = { which = prov_growth_rate value = 0.005 }
			}
			
			if = {
				limit = {
					owner = {
						stability = 3
					}
				}
				change_variable = { which = prov_growth_rate value = 0.005 }
			}
			
			if = {
				limit = {
					owner = {
						adm_tech = 2
					}
				}
				change_variable = { which = prov_growth_rate value = 0.0075 }
			}
			
			if = {
				limit = {
					has_building = farm1
				}
				change_variable = { which = prov_growth_rate value = 0.005 }
			}
			
			if = {
				limit = {
					has_building = farm2
				}
				change_variable = { which = prov_growth_rate value = 0.010 }
			}
			
			if = {
				limit = {
					province_trade_power = 5
				}
				change_variable = { which = prov_growth_rate value = 0.005 }
			}
			
			if = {
				limit = {
					province_trade_power = 10
				}
				change_variable = { which = prov_growth_rate value = 0.005 }
			}
			
			if = {
				limit = {
					province_trade_power = 20
				}
				change_variable = { which = prov_growth_rate value = 0.005 }
			}
			
			if = {
				limit = {
					OR = {
						trade_goods = grain
						trade_goods = aquaticfoods
						trade_goods = fruits
					}
				}
				change_variable = { which = prov_growth_rate value = 0.005 }
			}
			
			#NEGATIVE
			if = {
				limit = {
					check_variable = { which = prov_pop which = provpp }
				}
				change_variable = { which = prov_growth_rate value = -0.065 }
			}
			
			if = {
				limit = {
					NOT = { stability = 0 }
				}
				change_variable = { which = prov_growth_rate value = -0.005 }
			}
			
			if = {
				limit = {
					NOT = { stability = -1 }
				}
				change_variable = { which = prov_growth_rate value = -0.010 }
			}
			
			if = {
				limit = {
					NOT = { stability = -2 }
				}
				change_variable = { which = prov_growth_rate value = -0.015 }
			}
			
			if = {
				limit = {
					has_province_modifier = damaged_by_war 
				}
				change_variable = { which = prov_growth_rate value = -0.005 }
			}
			
			if = {
				limit = {
					has_province_modifier = devestated_by_war  
				}
				change_variable = { which = prov_growth_rate value = -0.010 }
			}
			
			if = {
				limit = {
					has_province_modifier = annihilated_by_war   
				}
				change_variable = { which = prov_growth_rate value = -0.015 }
			}
			
			#Store Total Pop in each category
			#Add a pop to the province if one of the three goes up enough in its category 
			
			#Set Change Values to the current total pop
			set_variable = { which = test1 which = elite_pop }
			set_variable = { which = test2 which = artisan_pop }
			set_variable = { which = test3 which = commoner_pop }
			
			#Set the change equal to the number of gained or lost persons
			multiply_variable = {
				which = test1
				which = prov_growth_rate
			}
			multiply_variable = {
				which = test2
				which = prov_growth_rate
			}
			multiply_variable = {
				which = test3
				which = prov_growth_rate
			}
			
			#Update the total pop with the number of gained/lost people
			change_variable = {
				which = elite_pop
				which = test1
			}
			change_variable = {
				which = artisan_pop
				which = test2
			}
			change_variable = {
				which = commoner_pop
				which = test3
			}
			
			change_variable = { which = elite_pop_change which = test1 }
			change_variable = { which = artisan_pop_change which = test2 }
			change_variable = { which = commoner_pop_change which = test3 }
			
			if = {
				limit = {
					check_variable = {
						which = prov_growth_rate
						value = 0.0
					}
				}
				
				while = {
					limit = {
						check_variable = {
							which = elite_pop_change
							value = 1000
						}
					}
					add_base_tax = 1
					subtract_variable = {
						which = elite_pop_change
						value = 1000
					}
				}
				
				while = {
					limit = {
						check_variable = {
							which = artisan_pop_change
							value = 1000
						}
					}
					add_base_production = 1
					subtract_variable = {
						which = artisan_pop_change
						value = 1000
					}
				}
				
				while = {
					limit = {
						check_variable = {
							which = commoner_pop_change
							value = 1000
						}
					}
					add_base_manpower = 1
					subtract_variable = {
						which = commoner_pop_change
						value = 1000
					}
				}
			}
			
			if = {
				limit = {
					NOT = { 
						check_variable = {
							which = prov_growth_rate
							value = 0.0
						}
					}
				}
				
				while = {
					limit = {
						NOT = { 
							check_variable = {
								which = elite_pop_change
								value = -1000
							}
						}
					}
					add_base_tax = -1
					subtract_variable = {
						which = elite_pop_change
						value = -1000
					}
				}
				
				while = {
					limit = {
						NOT = { 
							check_variable = {
								which = artisan_pop_change
								value = -1000
							}
						}
					}
					add_base_production = -1
					subtract_variable = {
						which = artisan_pop_change
						value = -1000
					}
				}
				
				while = {
					limit = {
						NOT = { 
							check_variable = {
								which = commoner_pop_change
								value = -1000
							}
						}
					}
					add_base_manpower = -1
					subtract_variable = {
						which = commoner_pop_change
						value = -1000
					}
				}
			}
		}		
	}	
}

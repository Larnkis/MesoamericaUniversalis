namespace = weakenms

#Repeal
country_event = {
	id = weakenms.01
	
	title = "weakenms1.t"
	desc = "weakenms1.d"
	picture = CIVIL_WAR_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		clr_country_flag = ms_will_resist
		if = {
			limit = {
				AND = {
					total_development = 100000
					NOT = { 
						estate_loyalty = {
							estate = estate_merchant
							loyalty = 60
						}
					}
					estate_influence = {
						estate = estate_merchant
						influence = 40
					}
				}
			}
			set_country_flag = ms_will_resist
		}
	}
	
	option = {
		name = "weakenms1.a"
		trigger = {
			has_country_flag = ms_repeal_sumptuary_laws
		}
		
		if = { #The Merchants are sick of your shit and leave to a different country
			limit = {
				NOT = {
					estate_loyalty = {
						estate = estate_merchant
						loyalty = 35
					}
				}
				NOT = { has_country_flag = ms_will_resist }
			}
			custom_tooltip = EST_leave_country
			clr_country_flag = has_merchants
			merchants_leave = yes
		}
		
		if = { #The Merchants hire mercenaries and fight back
			limit = {
				NOT = { 
					estate_loyalty = {
						estate = estate_merchant
						loyalty = 35
					}
				}
				has_country_flag = ms_will_resist
			}
			add_estate_loyalty = {
				estate = estate_merchant
				loyalty = -100
			}
			add_country_modifier = {
				name = ms_conflict_brewing
				duration = -1
			}
		}
		
		if = { #Merchants just accept it
			limit = {
				estate_loyalty = {
					estate = estate_merchant 
					loyalty = 35
				}
			}
			custom_tooltip = EST_repeal_priv
			custom_tooltip = EST_fav_d_020
			add_estate_loyalty = {
				estate = estate_merchant
				loyalty = -10
			}
			clr_country_flag = ms_repeal_sumptuary_laws
			hidden_effect = {
				change_variable = { which = ms_favors value = -20 }
			}
		}
	}
	
	option = {
		name = "weakenms1.b"
		trigger = {
			has_country_flag = ms_permit_land_ownership
		}
		
		if = { #The Merchants are sick of your shit and leave to a different country
			limit = {
				NOT = {
					estate_loyalty = {
						estate = estate_merchant
						loyalty = 35
					}
				}
				NOT = { has_country_flag = ms_will_resist }
			}
			custom_tooltip = EST_leave_country
			clr_country_flag = has_merchants
			merchants_leave = yes
		}
		
		if = { #The Merchants hire mercenaries and fight back
			limit = {
				NOT = { 
					estate_loyalty = {
						estate = estate_merchant
						loyalty = 35
					}
				}
				has_country_flag = ms_will_resist
			}
			add_country_modifier = {
				name = ms_conflict_brewing
				duration = -1
			}
		}
		
		if = { #Merchants just accept it
			limit = {
				estate_loyalty = {
					estate = estate_merchant 
					loyalty = 35
				}
			}
			custom_tooltip = EST_repeal_priv
			custom_tooltip = EST_fav_d_020
			add_estate_loyalty = {
				estate = estate_merchant
				loyalty = -10
			}
			clr_country_flag = ms_permit_land_ownership
			hidden_effect = {
				change_variable = { which = ms_favors value = -20 }
			}
		}
	}
	
	option = {
		name = "weakenms1.c"
		trigger = {
			has_country_flag = ms_oppress_foreign_merchants
		}
		
		if = { #The Merchants are sick of your shit and leave to a different country
			limit = {
				NOT = {
					estate_loyalty = {
						estate = estate_merchant
						loyalty = 35
					}
				}
				NOT = { has_country_flag = ms_will_resist }
			}
			custom_tooltip = EST_leave_country
			clr_country_flag = has_merchants
			merchants_leave = yes 
		}
		
		if = { #The Merchants hire mercenaries and fight back
			limit = {
				NOT = { 
					estate_loyalty = {
						estate = estate_merchant
						loyalty = 35
					}
				}
				has_country_flag = ms_will_resist
			}
			add_country_modifier = {
				name = ms_conflict_brewing
				duration = -1
			}
		}
		
		if = { #Merchants just accept it
			limit = {
				estate_loyalty = {
					estate = estate_merchant 
					loyalty = 35
				}
			}
			custom_tooltip = EST_repeal_priv
			custom_tooltip = EST_fav_d_020
			add_estate_loyalty = {
				estate = estate_merchant
				loyalty = -10
			}
			clr_country_flag = ms_oppress_foreign_merchants
			hidden_effect = {
				change_variable = { which = ms_favors value = -20 }
			}
		}
	}
	
	option = {
		name = "weakenms1.dd"
		trigger = {
			has_country_flag = ms_unlimited_trade
		}
		
		if = { #The Merchants are sick of your shit and leave to a different country
			limit = {
				NOT = {
					estate_loyalty = {
						estate = estate_merchant
						loyalty = 35
					}
				}
				NOT = { has_country_flag = ms_will_resist }
			}
			custom_tooltip = EST_leave_country
			clr_country_flag = has_merchants
			merchants_leave = yes
		}
		
		if = { #The Merchants hire mercenaries and fight back
			limit = {
				NOT = { 
					estate_loyalty = {
						estate = estate_merchant
						loyalty = 35
					}
				}
				has_country_flag = ms_will_resist
			}
			add_country_modifier = {
				name = ms_conflict_brewing
				duration = -1
			}
		}
		
		if = { #Merchants just accept it
			limit = {
				estate_loyalty = {
					estate = estate_merchant 
					loyalty = 35
				}
			}
			custom_tooltip = EST_repeal_priv
			custom_tooltip = EST_fav_d_020
			add_estate_loyalty = {
				estate = estate_merchant
				loyalty = -10
			}
			clr_country_flag = ms_unlimited_trade
			hidden_effect = {
				change_variable = { which = ms_favors value = -20 }
			}
		}
	}
	
	option = {
		name = "weakenms1.e"
		trigger = {
			has_country_flag = ms_guarantee_legal_protection
		}
		
		if = { #The Merchants are sick of your shit and leave to a different country
			limit = {
				NOT = {
					estate_loyalty = {
						estate = estate_merchant
						loyalty = 35
					}
				}
				NOT = { has_country_flag = ms_will_resist }
			}
			custom_tooltip = EST_leave_country
			clr_country_flag = has_merchants
			merchants_leave = yes
		}
		
		if = { #The Merchants hire mercenaries and fight back
			limit = {
				NOT = { 
					estate_loyalty = {
						estate = estate_merchant
						loyalty = 35
					}
				}
				has_country_flag = ms_will_resist
			}
			add_country_modifier = {
				name = ms_conflict_brewing
				duration = -1
			}
		}
		
		if = { #Merchants just accept it
			limit = {
				estate_loyalty = {
					estate = estate_merchant 
					loyalty = 35
				}
			}
			custom_tooltip = EST_repeal_priv
			custom_tooltip = EST_fav_d_020
			add_estate_loyalty = {
				estate = estate_merchant
				loyalty = -10
			}
			clr_country_flag = ms_guarantee_legal_protection
			hidden_effect = {
				change_variable = { which = ms_favors value = -20 }
			}
		}
	}
	
	option = {
		name = "weakenms1.f"
	}
}

#Conflict Begins (Only happens if the Merchants decide to resist)
country_event = {
	id = weakenms.02
	
	title = "weakenms2.t"
	desc = "weakenms2.d"
	picture = CIVIL_WAR_eventPicture
	
	is_triggered_only = yes
	
	mean_time_to_happen = {
		days = 1
	}
	
	option ={
		name = "weakenms2.a"
		remove_country_modifier = ms_conflict_brewing
		add_stability = -1
		
		add_estate_loyalty = {
			estate = estate_merchant
			loyalty = -100
		}
		
		random_owned_province = {
			spawn_rebels = {
				type = merchant_merc_rebels
				size = 3
			}
		}
		
		random_owned_province = {
			spawn_rebels = {
				type = merchant_merc_rebels
				size = 3
			}
		}
		
		every_owned_province = {
			limit = {
				has_estate = estate_merchant
			}
			spawn_rebels = {
				type = merchant_merc_rebels
				win = yes
				size = 2
			}
		}
		
		hidden_effect = {
			subtract_variable = { which = ms_favors which = ms_favors }
			clr_country_flag = ms_repeal_sumptuary_laws
			clr_country_flag = ms_permit_land_ownership
			clr_country_flag = ms_oppress_foreign_merchants
			clr_country_flag = ms_unlimited_trade
			clr_country_flag = ms_guarantee_legal_protection
		}
	}
}

#Conflict Ends in Victory
country_event = {
	id = weakenms.03
	
	title = "weakenms3.t"
	desc = "weakenms3.d"
	picture = CONQUEST_NATIVE_eventPicture
	
	trigger = {
		has_disaster = ms_conflict
		NOT = { has_spawned_rebels = merchant_merc_rebels }
	}
	
	mean_time_to_happen = {
		days = 5
	}
	
	option = { #Create new Bourgeoisie
		name = "weakenms3.a"
		
		end_disaster = ms_conflict
		
		add_years_of_income = -1.5
			
		add_estate_loyalty = {
			estate = estate_merchant
			loyalty = 70
		}
		
		add_country_modifier = {
			name = weakened_ms
			duration = 9125
		}
		
		custom_tooltip = EST_fav_i_100
		hidden_effect = {
			change_variable = { which = ms_favors value = 100 }
		}
	}
	
	option = { #Seize the Means of Production
		name = "weakenms3.b"
		
		end_disaster = ms_conflict
		
		custom_tooltip = EST_leave_country
		clr_country_flag = has_merchants
	}
}

#Conflict Ends in Defeat
country_event = {
	id = weakenms.04
	
	title = "weakenms4.t"
	desc = "weakenms4.d"
	picture = CONQUEST_NATIVE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "weakenms4.a"
		
		end_disaster = ms_conflict 
		
		add_stability = -1
		kill_ruler = yes
		add_estate_loyalty = {
			estate = estate_merchant
			loyalty = 40
		}
		
		hidden_effect = {
			set_country_flag = ms_repeal_sumptuary_laws
			set_country_flag = ms_permit_land_ownership
			set_country_flag = ms_oppress_foreign_merchants
			set_country_flag = ms_unlimited_trade
			set_country_flag = ms_guarantee_legal_protection
		}
	}
}

country_event = {
	id = weakenms.05
	
	title = "weakenms5.t"
	desc = "weakenms5.d"
	
	picture = LAND_MILITARY_eventPicture
	
	trigger = {
		has_disaster = ms_conflict
		num_of_cities = 2
	}
	
	mean_time_to_happen = {
		months = 8
	}
	
	option = {
		name = "weakenms5.a"
		
		random_owned_province = { 
			limit = {
				is_capital = no
			}
			spawn_rebels = {
				type = merchant_merc_rebels
				win = yes
				size = 3
			}
		}
	}
}
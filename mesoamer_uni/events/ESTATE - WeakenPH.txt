namespace = weakenph 

#Repeal
country_event = {
	id = weakenph.01
	
	title = "weakenph1.t"
	desc = "weakenph1.d"
	picture = CIVIL_WAR_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		clr_country_flag = ph_will_resist 
		if = {
			limit = {
				AND = {
					total_development = 50000
					check_variable = { which = religioustradition value = 80 }
					estate_influence = {
						estate = estate_priesthood
						influence = 40
					}
					NOT = {
						estate_loyalty = {
							estate = estate_priesthood
							loyalty = 40
						}
					}
				}
			}
			set_country_flag = ph_will_resist 
		}
	}
	
	option = {
		name = "weakenph1.a"
		trigger = {
			has_country_flag = ph_lift_political_embargoes
		}
		
		if = { #Priests Fight Back
			limit = {
				has_country_flag = ph_will_resist 
			}
			add_estate_loyalty = {
				estate = estate_priesthood
				loyalty = -100
			}
			add_country_modifier = {
				name = ph_conflict_brewing
				duration = -1
			}
		}
		
		if = { #Priests let it happen
			limit = {
				NOT = { has_country_flag = ph_will_resist }
			}
			custom_tooltip = EST_repeal_priv
			custom_tooltip = EST_fav_d_020
			add_estate_loyalty = {
				estate = estate_priesthood
				loyalty = -10
			}
			clr_country_flag = ph_lift_political_embargoes
			
			hidden_effect = {
				change_variable = { which = ph_favors value = -20 }
			}
		}
	}
	
	option = {
		name = "weakenph1.b"
		trigger = {
			has_country_flag = ph_reserve_advisories
		}
		
		if = { #Priests Fight Back
			limit = {
				has_country_flag = ph_will_resist 
			}
			add_estate_loyalty = {
				estate = estate_priesthood
				loyalty = -100
			}
			add_country_modifier = {
				name = ph_conflict_brewing
				duration = -1
			}
		}
		
		if = { #Priests let it happen
			limit = {
				NOT = { has_country_flag = ph_will_resist }
			}
			custom_tooltip = EST_repeal_priv
			custom_tooltip = EST_fav_d_020
			add_estate_loyalty = {
				estate = estate_priesthood
				loyalty = -10
			}
			clr_country_flag = ph_reserve_advisories
			
			hidden_effect = {
				change_variable = { which = ph_favors value = -20 }
			}
		}
	}
	
	option = {
		name = "weakenph1.c"
		trigger = {
			has_country_flag = ph_withold_legal_judgement
		}
		
		if = { #Priests Fight Back
			limit = {
				has_country_flag = ph_will_resist 
			}
			add_estate_loyalty = {
				estate = estate_priesthood
				loyalty = -100
			}
			add_country_modifier = {
				name = ph_conflict_brewing
				duration = -1
			}
		}
		
		if = { #Priests let it happen
			limit = {
				NOT = { has_country_flag = ph_will_resist }
			}
			custom_tooltip = EST_repeal_priv
			custom_tooltip = EST_fav_d_020
			add_estate_loyalty = {
				estate = estate_priesthood
				loyalty = -10
			}
			clr_country_flag = ph_withold_legal_judgement
			
			hidden_effect = {
				change_variable = { which = ph_favors value = -20 }
			}
		}
	}
	
	option = {
		name = "weakenph1.dd"
		trigger = {
			has_country_flag = ph_elevate_social_status
		}
		
		if = { #Priests Fight Back
			limit = {
				has_country_flag = ph_will_resist 
			}
			add_estate_loyalty = {
				estate = estate_priesthood
				loyalty = -100
			}
			add_country_modifier = {
				name = ph_conflict_brewing
				duration = -1
			}
		}
		
		if = { #Priests let it happen
			limit = {
				NOT = { has_country_flag = ph_will_resist }
			}
			custom_tooltip = EST_repeal_priv
			custom_tooltip = EST_fav_d_020
			add_estate_loyalty = {
				estate = estate_priesthood
				loyalty = -10
			}
			clr_country_flag = ph_elevate_social_status
			
			hidden_effect = {
				change_variable = { which = ph_favors value = -20 }
			}
		}
	}
	
	option = {
		name = "weakenph1.e"
		trigger = {
			has_country_flag = ph_mandate_religious_schooling
		}
		
		if = { #Priests Fight Back
			limit = {
				has_country_flag = ph_will_resist 
			}
			add_estate_loyalty = {
				estate = estate_priesthood
				loyalty = -100
			}
			add_country_modifier = {
				name = ph_conflict_brewing
				duration = -1
			}
		}
		
		if = { #Priests let it happen
			limit = {
				NOT = { has_country_flag = ph_will_resist }
			}
			custom_tooltip = EST_repeal_priv
			custom_tooltip = EST_fav_d_020
			add_estate_loyalty = {
				estate = estate_priesthood
				loyalty = -10
			}
			clr_country_flag = ph_mandate_religious_schooling
			
			hidden_effect = {
				change_variable = { which = ph_favors value = -20 }
			}
		}
	}
	
	option = {
		name = "weakenph1.f"
	}
}

#Conflict Begins
country_event = {
	id = weakenph.02
	
	title = "weakenph2.t"
	desc = "weakenph2.d"
	picture = CIVIL_WAR_eventPicture
	
	is_triggered_only = yes
	
	mean_time_to_happen = {
		days = 1
	}
	
	option ={
		name = "weakenph2.a"
		remove_country_modifier = ph_conflict_brewing
		add_stability = -1
		
		add_estate_loyalty = {
			estate = estate_priesthood
			loyalty = -100
		}
		
		random_owned_province = {
			spawn_rebels = {
				type = holy_rebels
				size = 3
			}
		}
		
		random_owned_province = {
			spawn_rebels = {
				type = holy_rebels
				size = 3
			}
		}
		
		every_owned_province = {
			limit = {
				has_estate = estate_priesthood
			}
			spawn_rebels = {
				type = holy_rebels
				win = yes
				size = 2
			}
		}
		
		hidden_effect = {
			subtract_variable = { which = ph_favors which = ph_favors }
			clr_country_flag = ph_lift_political_embargoes
			clr_country_flag = ph_reserve_advisories
			clr_country_flag = ph_withold_legal_judgement
			clr_country_flag = ph_elevate_social_status
			clr_country_flag = ph_mandate_religious_schooling
		}
	}
}

#Victory
country_event = {
	id = weakenph.03
	
	title = "weakenph3.t"
	desc = "weakenph3.d"
	picture = CONQUEST_eventPicture
	
	trigger = {
		has_disaster = ph_uprising
		NOT = { has_spawned_rebels = holy_rebels }
	}
	
	mean_time_to_happen = {
		days = 5
	}
	
	option = { 
		name = "weakenph3.a"
		
		end_disaster = ph_uprising
		
		add_years_of_income = -1.50
			
		add_estate_loyalty = {
			estate = estate_priesthood
			loyalty = 70
		}
		
		add_country_modifier = {
			name = weakened_ph
			duration = 9125
		}
		
		custom_tooltip = GOVS_sprt_d_0250
		custom_tooltip = EST_fav_i_100
		hidden_effect = {
			change_variable = { which = ph_favors value = 100 }
			change_variable = { which = religioustradition value = -25 }
		}
	}
	
	option = { 
		name = "weakenph3.b"
		
		end_disaster = ph_uprising
		
		custom_tooltip = EST_leave_country
		custom_tooltip = GOVS_sprt_d_0500
		clr_country_flag = has_priesthood
		
		hidden_effect = {
			change_variable = { which = religioustradition value = -50 }
		}
	}
}

#Defeat
country_event = {
	id = weakenph.04
	
	title = "weakenph4.t"
	desc = "weakenph4.d"
	picture = CONQUEST_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "weakenph4.a"
		
		end_disaster = ph_uprising 
		
		add_stability = -1
		kill_ruler = yes
		add_estate_loyalty = {
			estate = estate_priesthood
			loyalty = 40
		}
		
		hidden_effect = {
			set_country_flag = ph_lift_political_embargoes
			set_country_flag = ph_reserve_advisories
			set_country_flag = ph_withold_legal_judgement
			set_country_flag = ph_elevate_social_status
			set_country_flag = ph_mandate_religious_schooling
		}
	}
}

country_event = {
	id = weakenph.05
	
	title = "weakenph5.t"
	desc = "weakenph5.d"
	
	picture = LAND_MILITARY_eventPicture
	
	trigger = {
		has_disaster = ph_uprising
		num_of_cities = 2
	}
	
	mean_time_to_happen = {
		months = 8
	}
	
	option = {
		name = "weakenph5.a"
		
		random_owned_province = { 
			limit = {
				is_capital = no
			}
			spawn_rebels = {
				type = holy_rebels
				win = yes
				size = 3
			}
		}
	}
}